C51 COMPILER V9.57.0.0   CHINPRO                                                           01/25/2022 02:31:29 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE CHINPRO
OBJECT MODULE PLACED IN ChinPro.OBJ
COMPILER INVOKED BY: H:\Keil_v5\C51\BIN\C51.EXE ChinPro.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          安徽工程大学电子科技协会大作业
   3          *专业：集成电路设计与集成系统
   4          *姓名：秦煜杰
   5          *题目：让led灯每隔0.5秒依次序点亮并且依次序熄灭；
   6          *       让数码管每隔10毫秒从0.00加0.01至9999
   7          *       有0去0，小数点前满了小数点后移但是速率不变
   8          *       利用按键可以暂停和解除这两个过程
   9          *解析：速率不变理解为加0.01的速率不变，有0去0理解为有效数字，
  10          *       led依次序亮灭理解为依次序亮满，再依次序全灭，但是题目未说明方向
  11          *******************************************************************************/
  12          #include<reg52.h>
  13          #define uint unsigned int
  14          #define uchar unsigned char
  15          
  16          sbit N1=P2^3;
  17          sbit N2=P2^4;
  18          sbit N3=P2^5;
  19          sbit N4=P2^6;
  20          sbit key0=P3^3;
  21          sbit judge=P1^7;                //led判断变量，通过该变量确定整体状态，实现led的循环亮灭
  22          
  23          uchar a[]={0x05,0x7d,0x46,0x54,0x3c,0x94,0x84,0x5d,0x04,0x14};//数码管'0'至'9'
  24          uchar b[]={0x01,0x79,0x42,0x50,0x38,0x90,0x80,0x59,0x00,0x10};//数码管'0.'至'9.'
  25          
  26          uint x,y,z;             //x储存整数部分，y储存第一个小数，z储存第二个小数
  27          uchar num,kc=1;
  28          
  29          void main()
  30          {
  31   1              void delay(uint xms);                                   //延迟函数
  32   1              void display(uint x,uint y,uint z);     //显示函数
  33   1              void count();                                                           //计数函数
  34   1              void case1(uint x);
  35   1              void case2(uint x,uint y);
  36   1              void case3(uint x,uint y,uint z);
  37   1              void fourth(uint k);
  38   1              void third(uint k);
  39   1              void thirds(uint k);
  40   1              void second(uint k);
  41   1              void seconds(uint k);
  42   1              void first(uint k);
  43   1              EA=1;                   //总中断开启
  44   1              EX0=1;          //允许外部中断
  45   1              IT0=1;          
  46   1              TMOD=0x01;      //设置定时器工作方式为16位定时器
  47   1              TH0=(65536-45872)/256;
  48   1              TL0=(65536-45872)%256;
  49   1              ET0=1;          //定时器中断开启
  50   1              TR0=1;          //开启定时器
  51   1              count();
  52   1      }
  53          
  54          //****负责计数，将要现实的数进行拆分为xyz****//
  55          void count()
C51 COMPILER V9.57.0.0   CHINPRO                                                           01/25/2022 02:31:29 PAGE 2   

  56          {
  57   1              x=0;y=0;z=0;
  58   1              while(x<=9999)
  59   1              {
  60   2                      display(x,y,z);
  61   2                      P0=0xff;                //消除残影
  62   2                      delay(10);
  63   2                      z++;                    //延迟10秒之后加0.01
  64   2                      if(z==10){y++;z=0;}
  65   2                      if(y==10){x++;y=0;}
  66   2              }
  67   1      }
  68          
  69          //***********负责延迟，延迟xms毫秒***********//
  70          void delay(uint xms)
  71          {
  72   1              uint i;
  73   1              for(;xms>0;xms--)
  74   1              for(i=110;i>0;i--);
  75   1      }
  76          
  77          //***负责将拆分的数字再划分，分配到下一过程***//
  78          void display(uint x,uint y,uint z)
  79          {
  80   1              uint p,q,m,n;
  81   1              p=x/1000;       //千位
  82   1              q=x/100%10;     //百位
  83   1              m=x/10%10;      //十位
  84   1              n=x%10;         //个位
  85   1              
  86   1              if(y==0&&z==0)          //0~9999
  87   1                      case1(x);
  88   1              else if(z==0)           //x.1~x.9;特殊:8888.9
  89   1                      case2(x,y);
  90   1              else                                    //x.01~x.y9;特殊:8888.99#888.99
  91   1                      case3(x,y,z);
  92   1      }
  93          
  94          //************负责0~9999的显示分配***********//
  95          void case1(uint x)
  96          {
  97   1              uint p,q,m,n;
  98   1              p=x/1000;       //千位
  99   1              q=x/100%10;     //百位
 100   1              m=x/10%10;      //十位
 101   1              n=x%10;         //个位
 102   1              
 103   1              if(p!=0)                        //四位数显示分配
 104   1              {fourth(p);third(q);second(m);first(n);}
 105   1              else if(q!=0)   //三位数显示分配
 106   1              {third(q);second(m);first(n);}
 107   1              else if(m!=0)   //两位数显示分配
 108   1              {second(m);first(n);}
 109   1              else                            //个位数显示分配
 110   1              {first(n);}
 111   1      }
 112          
 113          //*********负责小数点后一位的显示分配*********//
 114          void case2(uint x,uint y)
 115          {
 116   1              uint p,q,m,n;
 117   1              p=x/1000;       //千位
C51 COMPILER V9.57.0.0   CHINPRO                                                           01/25/2022 02:31:29 PAGE 3   

 118   1              q=x/100%10;     //百位
 119   1              m=x/10%10;      //十位
 120   1              n=x%10;         //个位
 121   1              
 122   1              if(p!=0)
 123   1                      case1(x);                                                                                               //pqmn.y->pqmn
 124   1              else if(q!=0)
 125   1                      {fourth(q);third(m);seconds(n);first(y);}               //0qmn.y->qmn.y
 126   1              else if(m!=0)
 127   1                      {third(m);seconds(n);first(y);}                                 //00mn.y->_xx.x
 128   1              else
 129   1                      {seconds(n);first(y);}                                                          //000n.y->__n.y
 130   1      }
 131          
 132          //*********负责小数点后两位的显示分配************//
 133          void case3(uint x,uint y,uint z)
 134          {
 135   1              uint p,q,m,n;
 136   1              p=x/1000;       //千位
 137   1              q=x/100%10;     //百位
 138   1              m=x/10%10;      //十位
 139   1              n=x%10;         //个位
 140   1              
 141   1              if(p!=0)
 142   1                      case1(x);                                                                                               //pqmn.yz->pqmn
 143   1              else if(q!=0)
 144   1                      case2(x,y);                                                                                             //_qmn.yz->qmn.y
 145   1              else if(m!=0)
 146   1                      {fourth(m);thirds(n);second(y);first(z);}               //__mn.yz->mn.yz
 147   1              else
 148   1                      {thirds(n);second(y);first(z);}                                 //n.yz->_n.yz
 149   1      }
 150          
 151          //********不带小数点****第一个数码管显示*********//
 152          void fourth(uint k)
 153          {
 154   1              N1=0;
 155   1              P0=a[k];
 156   1              delay(1);
 157   1              N1=1;
 158   1      }
 159          
 160          //********不带小数点****第二个数码管显示*********//
 161          void third(uint k)
 162          {
 163   1              N2=0;
 164   1              P0=a[k];
 165   1              delay(1);
 166   1              N2=1;
 167   1      }
 168          
 169          //********带小数点****第二个数码管显示*********//
 170          void thirds(uint k)
 171          {
 172   1              N2=0;
 173   1              P0=b[k];
 174   1              delay(1);
 175   1              N2=1;
 176   1      }
 177          
 178          //********不带小数点****第三个数码管显示*********//
 179          void second(uint k)
C51 COMPILER V9.57.0.0   CHINPRO                                                           01/25/2022 02:31:29 PAGE 4   

 180          {
 181   1              N3=0;
 182   1              P0=a[k];
 183   1              delay(1);
 184   1              N3=1;
 185   1      }
 186          
 187          //********带小数点****第三个数码管显示*********//
 188          void seconds(uint k)
 189          {
 190   1              N3=0;
 191   1              P0=b[k];
 192   1              delay(1);
 193   1              N3=1;
 194   1      }
 195          
 196          //********不带小数点****第一个数码管显示*********//
 197          void first(uint k)
 198          {
 199   1              N4=0;
 200   1              P0=a[k];
 201   1              delay(1);
 202   1              N4=1;
 203   1      }
 204          
 205          //*********外部中断*****按键控制显示状态**********//
 206          //实现方法:通过不断扫描按键状态结束中断
 207          void ext_0() interrupt 0
 208          {
 209   1              kc=1;
 210   1              while(kc==1)
 211   1              {
 212   2                      display(x,y,z);
 213   2                      if(!key0)               //按一下执行
 214   2                      {kc=!kc;}
 215   2              }
 216   1      }
 217          
 218          //********定时器中断*****LED灯的显示*******//
 219          //实现方法:通过判断led8的接口状态确定移入led1的状态，整体左移
 220          void T0_time() interrupt 1
 221          {
 222   1              TH0=(65536-45872)/256;
 223   1              TL0=(65536-45872)%256;
 224   1              num++;
 225   1              if(num==10)
 226   1              {
 227   2                      num=0;
 228   2                      if(judge==0)                    //当最下端灯灭时
 229   2                      P1=((P1<<1)+1);         //左移后最上端亮
 230   2                      else                                            //否则
 231   2                      P1=P1<<1;                               //左移后最上端灭
 232   2              }
 233   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    896    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     28      40
C51 COMPILER V9.57.0.0   CHINPRO                                                           01/25/2022 02:31:29 PAGE 5   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
